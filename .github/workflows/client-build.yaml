name: Build Client

on:
  workflow_call:
    inputs:
      directory:
        description: 'Directory of the game which contains the client'
        required: true
        type: string

jobs:
  load-build-config:
    runs-on: ubuntu-latest
    outputs:
      build-configs-matrix: ${{ steps.parse_yaml.outputs.result }}
    steps:
      - uses: actions/checkout@v4

      - name: Read and Parse YAML to JSON Array
        id: parse_yaml
        uses: mikefarah/yq@v4
        with:
          cmd: yq -o=json '.games' ${{ github.event.inputs.directory }}/variants.yaml

      - name: Debug Parsed JSON Output
        run: |
          echo "Parsed JSON: ${{ steps.parse_yaml.outputs.result }}"

  build-and-upload:
    runs-on: ubuntu-latest
    needs: [load-build-config]
    strategy:
      matrix:
        build-config: ${{ fromJson(needs.load-build-config.outputs.build-configs-matrix) }}  
    steps:
      - uses: actions/checkout@v4

      - name: Debug Build Config
        run: |
          echo "Using command: ${{ matrix.build-config.client-build-command }}"
